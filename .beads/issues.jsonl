{"id":"unpaperwallet_org-1ge","title":"Task: Add Esplora API integration and validation","description":"## Objective\nAdd API fetching logic to retrieve UTXOs from Blockstream Esplora API with proper validation and error handling.\n\n## File to Modify\n`utils.js` (add new functions)\n\n## Functions to Add\n\n### 1. fetchUTXOs(address, isTestnet)\n```javascript\n/**\n * Fetch UTXOs for a Bitcoin address from Blockstream Esplora API\n * @param {string} address - Bitcoin address\n * @param {boolean} isTestnet - Use testnet API\n * @returns {Promise\u003cArray\u003e} Array of UTXO objects\n */\nasync function fetchUTXOs(address, isTestnet = false) {\n  // Validate address format first using existing validateBitcoinAddress()\n  try {\n    validateBitcoinAddress(address);\n  } catch (error) {\n    throw new Error(\\`Invalid address: \\${error.message}\\`);\n  }\n\n  const network = isTestnet ? 'testnet' : 'api';\n  const url = \\`https://blockstream.info/\\${network}/address/\\${address}/utxo\\`;\n\n  try {\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: { 'Accept': 'application/json' },\n      signal: AbortSignal.timeout(10000) // 10 second timeout\n    });\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        throw new Error('Address not found or has no UTXOs');\n      }\n      throw new Error(\\`API error: \\${response.status} \\${response.statusText}\\`);\n    }\n\n    const data = await response.json();\n    \n    // Validate response is array\n    if (!Array.isArray(data)) {\n      throw new Error('Invalid API response format');\n    }\n\n    // Validate each UTXO\n    data.forEach((utxo, index) =\u003e {\n      if (!utxo.txid || typeof utxo.txid !== 'string' || utxo.txid.length !== 64) {\n        throw new Error(\\`Invalid txid at index \\${index}\\`);\n      }\n      if (typeof utxo.vout !== 'number' || utxo.vout \u003c 0) {\n        throw new Error(\\`Invalid vout at index \\${index}\\`);\n      }\n      if (typeof utxo.value !== 'number' || utxo.value \u003c= 0) {\n        throw new Error(\\`Invalid value at index \\${index}\\`);\n      }\n      if (!utxo.status || typeof utxo.status !== 'object') {\n        throw new Error(\\`Invalid status at index \\${index}\\`);\n      }\n    });\n\n    return data;\n  } catch (error) {\n    if (error.name === 'AbortError') {\n      throw new Error('Request timeout - API took too long to respond');\n    }\n    throw error;\n  }\n}\n```\n\n### 2. formatSatoshis(sats)\n```javascript\n/**\n * Format satoshis with thousands separators\n */\nfunction formatSatoshis(sats) {\n  return sats.toLocaleString('en-US');\n}\n```\n\n### 3. shortenTxid(txid)\n```javascript\n/**\n * Shorten txid for display (first 8...last 8 chars)\n */\nfunction shortenTxid(txid) {\n  return \\`\\${txid.substring(0, 8)}...\\${txid.substring(56)}\\`;\n}\n```\n\n## Testing Checklist\n- [ ] Valid mainnet address returns UTXOs\n- [ ] Valid testnet address returns UTXOs (with testMode=true)\n- [ ] Invalid address format throws error\n- [ ] Address with no UTXOs returns empty array or throws appropriate error\n- [ ] Network timeout handled gracefully\n- [ ] Malformed API response caught and throws error\n- [ ] Each UTXO field validated (txid, vout, value, status)\n\n## Acceptance Criteria\n- [ ] fetchUTXOs() function works for mainnet and testnet\n- [ ] All API responses validated before returning\n- [ ] Error messages are user-friendly\n- [ ] Timeout set to prevent hanging requests\n- [ ] Helper functions (formatSatoshis, shortenTxid) work correctly","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T15:55:15.114963365+01:00","updated_at":"2025-12-07T15:55:15.114963365+01:00"}
{"id":"unpaperwallet_org-erf","title":"Add Playwright E2E Testing Framework","description":"## User Story\n\nAs a **developer**,\nI want **Playwright end-to-end testing framework set up**,\nSo that **I can verify critical user workflows and prevent regressions**.\n\n---\n\n## Story Context\n\n**Existing System Integration:**\n- Integrates with: Static web application (HTML/CSS/JS)\n- Technology: Vanilla JavaScript, no build framework\n- Follows pattern: New testing infrastructure (no existing tests)\n- Touch points: Local dev server (http://localhost:8000), offline mode, QR scanner\n\n---\n\n## Acceptance Criteria\n\n### Functional Requirements:\n1. Playwright installed and configured for the project\n2. Basic test suite covering critical paths:\n   - Page loads successfully\n   - Offline mode enforcement works\n   - Test mode toggle functions\n3. Tests run successfully via npm script\n\n### Integration Requirements:\n4. Existing application code remains unchanged\n5. Tests work with local dev server setup\n6. Test configuration supports offline/online testing scenarios\n\n### Quality Requirements:\n7. All tests pass on initial run\n8. Documentation added for running tests\n9. CI-ready configuration (can be extended later)\n\n---\n\n## Technical Notes\n\n- **Integration Approach**: Playwright runs against local server (localhost:8000)\n- **Existing Pattern Reference**: No existing test patterns - establishing new standard\n- **Key Constraints**: \n  - Must support offline testing (security model)\n  - Static files only (no build step required)\n  - Browser-based testing (Chrome/Firefox)\n\n---\n\n## Definition of Done\n\n- [ ] Playwright installed (`npm install -D @playwright/test`)\n- [ ] `playwright.config.js` created with appropriate settings\n- [ ] Basic smoke tests written (3-5 tests minimum)\n- [ ] `npm test` script configured and working\n- [ ] Tests pass locally\n- [ ] README/docs updated with test instructions\n\n---\n\n## Risk and Compatibility\n\n**Primary Risk:** Test framework adds dev dependencies but shouldn't affect production bundle\n**Mitigation:** Keep Playwright as devDependency only, no runtime impact\n**Rollback:** Remove devDependencies and test files\n\n**Compatibility:**\n- ✅ No breaking changes to production code\n- ✅ No database changes needed\n- ✅ No UI changes\n- ✅ Performance impact: None (tests run separately)\n\n---\n\n**Estimated Effort:** Single development session (2-4 hours)\n**Type:** Brownfield Addition - Testing Infrastructure","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T15:36:12.432153146+01:00","updated_at":"2025-12-07T15:36:12.432153146+01:00"}
{"id":"unpaperwallet_org-n8n","title":"Feature: Auto-fetch UTXOs using Blockstream Esplora API","description":"## Overview\nAdd ability to automatically fetch UTXOs for a Bitcoin address using Blockstream's Esplora API, eliminating manual lookup on mempool.space while maintaining offline-first security model.\n\n## User Story\nAs a user with a paper wallet, I want to automatically fetch my UTXOs by entering my address, so that I don't have to manually copy transaction IDs and amounts from a block explorer.\n\n## Acceptance Criteria\n- User can enter a Bitcoin address and fetch UTXOs\n- UTXOs are displayed in a clear, selectable list\n- Selected UTXO auto-fills the transaction form\n- Manual entry still works (no breaking changes)\n- Only works when online (respects security model)\n- Supports both mainnet and testnet\n\n## API Reference\n- Mainnet: `https://blockstream.info/api/address/{address}/utxo`\n- Testnet: `https://blockstream.info/testnet/api/address/{address}/utxo`\n- Response: Array of `{txid, vout, value, status}` objects\n\n## Implementation Broken Into Tasks\nSee dependent task issues for detailed implementation specs.\n\n## Security Requirements\n- Validate all API responses\n- Never auto-fill private key\n- Keep offline-first security model\n- Maintain all existing security warnings","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-07T15:54:51.474447442+01:00","updated_at":"2025-12-07T15:54:51.474447442+01:00"}
{"id":"unpaperwallet_org-tuv","title":"Fix QR Scanner for Private Key Input","description":"Fix the broken QR scanner feature in ui-manager.js:175-268. Root cause: ES6 module loading issue with dynamic import (line 185). Users currently must manually type 51-52 character private keys.\n\n**References**:\n- PRD: docs/prd/index.md (full requirements \u0026 acceptance criteria)\n- Architecture: docs/architecture/the-qr-scanner-implementation-current-broken-state.md (implementation details \u0026 root causes)\n- Impact Analysis: docs/architecture/enhancement-impact-analysis-qr-scanner-fix.md\n- Implementation Checklist: docs/architecture/enhancement-implementation-checklist.md\n- Critical Files: docs/architecture/quick-reference-critical-files-for-qr-scanner-fix.md\n\n**Key Fixes Needed**:\n1. Fix module loading context in index.html\n2. Configure QrScanner.WORKER_PATH\n3. Test across Chrome/Firefox/Brave","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-07T12:53:37.908312431+01:00","updated_at":"2025-12-07T13:38:33.515580609+01:00","closed_at":"2025-12-07T13:38:33.515580609+01:00"}
